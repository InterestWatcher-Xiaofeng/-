# 📧 评论智能回复功能说明

## 🎯 功能介绍

这是一个**智能评论回复系统**，可以帮你：

1. ✅ **采集评论** - 从视频下采集所有评论
2. ✅ **筛选评论** - 自动找出需要回复的有价值评论
3. ✅ **定位评论** - 在视频页面中精准找到目标评论
4. ✅ **自动回复** - 点击回复按钮并发送回复内容

---

## 🚀 快速开始

### 方式1：快速回复（推荐新手）

```bash
# 运行快速回复脚本
python 快速回复评论.py
```

选择模式：
- **模式1**：手动指定要回复的评论
- **模式2**：自动从文件加载评论并筛选回复

---

### 方式2：完整工作流（推荐高级用户）

```bash
# 运行完整工作流
python comment_reply_workflow.py
```

工作流程：
```
1. 采集评论 → 2. 筛选评论 → 3. 人工确认 → 4. 自动回复 → 5. 生成报告
```

---

## 📖 详细使用教程

### 第一步：采集评论

**方式A：使用GUI采集**

1. 打开红枫工具箱
2. 登录抖音账号
3. 配置关键词或视频链接
4. 开始采集
5. 评论保存在 `data/douyin/` 目录

**方式B：使用命令行采集**

```bash
python main.py
```

---

### 第二步：筛选需要回复的评论

系统会自动筛选包含以下关键词的评论：

| 类型 | 关键词 |
|-----|--------|
| 询问价格 | "多少钱"、"价格"、"怎么卖" |
| 询问购买 | "哪里买"、"怎么买"、"链接"、"购买" |
| 询问详情 | "怎么样"、"好用吗"、"推荐吗" |
| 提问 | "？"、"吗"、"呢" |
| 求联系 | "微信"、"联系"、"私信" |

**自定义关键词：**

编辑 `tools/comment_filter.py`，添加你的关键词：

```python
self.keywords = [
    "你的关键词1",
    "你的关键词2",
    # ...
]
```

---

### 第三步：定义回复策略

在 `快速回复评论.py` 中配置回复策略：

```python
# 方式1：固定回复
comments_to_reply = [
    {
        "content": "这个多少钱？",
        "reply": "私信我获取价格哦~",
        "video_url": "https://www.douyin.com/video/xxx",
    },
]

# 方式2：智能回复（根据关键词自动选择回复）
def get_reply_text(content):
    if "多少钱" in content:
        return "私信我获取详细价格~"
    elif "哪里买" in content:
        return "商品链接已私信您~"
    else:
        return "感谢关注~"
```

---

### 第四步：执行回复

运行脚本后，系统会：

1. 🌐 启动浏览器（显示界面）
2. 📱 打开视频页面
3. 🔍 滚动查找目标评论
4. 💬 点击回复按钮
5. ⌨️ 输入回复内容
6. 📤 发送回复

**过程可视化：你可以看到整个操作过程！**

---

## ⚙️ 高级配置

### 1. 修改筛选规则

编辑 `tools/comment_filter.py`:

```python
# 添加关键词
filter.add_keyword("你的关键词")

# 添加排除关键词（不回复包含这些词的评论）
filter.add_exclude_keyword("广告")

# 选择筛选模式
filtered = filter.filter_comments(comments, mode="custom")
# mode可选: "keyword" | "question" | "high_like" | "custom"
```

---

### 2. 调整回复延迟

编辑 `tools/comment_replier.py`:

```python
# 修改评论间隔时间（秒）
delay = random.randint(5, 10)  # 改为你想要的范围

# 修改输入延迟（模拟真人打字速度）
await input_box.type(char, delay=random.randint(50, 150))
```

---

### 3. 批量回复策略

使用回复映射表：

```python
reply_mapping = {
    "多少钱": "私信我获取详细价格~",
    "哪里买": "商品链接已私信您~",
    "好用吗": "使用体验很不错，推荐试试~",
    "怎么联系": "已私信联系方式~",
    "default": "感谢您的关注！"  # 默认回复
}

results = await replier.batch_reply(comments, reply_mapping)
```

---

## 💡 使用场景

### 场景1：电商带货

```
需求: 回复询问价格和购买的用户
策略:
  - "多少钱" → "私信我获取优惠价格~"
  - "哪里买" → "商品链接已私信您~"
```

**使用方法：**
1. 采集视频评论
2. 筛选包含"多少钱"、"哪里买"的评论
3. 批量回复

---

### 场景2：客服问答

```
需求: 回答用户关于产品的问题
策略:
  - "怎么用" → "使用方法已私信~"
  - "质量如何" → "质量很好，用户反馈都不错~"
  - "有保修吗" → "支持一年保修~"
```

---

### 场景3：社群运营

```
需求: 邀请活跃用户加入社群
策略:
  - 高赞评论（>10赞） → "感谢支持！已私信社群邀请~"
  - 提出有价值问题 → "您的问题很好，私信拉您进交流群~"
```

---

## ⚠️ 重要提示

### 1. 账号安全

```
❌ 避免:
  - 短时间大量回复（>50条/小时）
  - 发送相同内容
  - 24小时不间断运行

✅ 建议:
  - 每条评论间隔5-10秒
  - 回复内容多样化
  - 每天限制<100条
  - 定期更换回复话术
```

---

### 2. 回复质量

```
✅ 好的回复:
  - 针对性强
  - 语气自然
  - 提供价值

❌ 避免:
  - 机械化回复
  - 广告刷屏
  - 无关内容
```

---

### 3. 平台规则

- ✅ 仅用于正常客服和用户互动
- ❌ 禁止发送垃圾信息
- ❌ 禁止恶意刷评论
- ❌ 禁止传播违法信息

**违规可能导致：**
- 评论被删除
- 账号被限流
- 账号被封禁

---

## 🔧 故障排查

### 问题1：找不到评论

**原因：**
- 评论在页面底部，需要滚动加载
- 评论内容不完全匹配

**解决：**
```python
# 增加滚动次数
max_scrolls = 30  # 默认20，改为30

# 使用部分匹配
if content in text or text in content:  # 支持部分匹配
```

---

### 问题2：找不到回复按钮

**原因：**
- 回复按钮需要悬停显示
- 选择器不匹配

**解决：**
```python
# 先悬停评论元素
await comment_element.hover()
await asyncio.sleep(0.5)

# 然后点击回复
await reply_btn.click()
```

---

### 问题3：发送失败

**原因：**
- 输入框未正确填充
- 发送按钮未点击

**解决：**
- 查看浏览器窗口，手动测试一次
- 根据实际页面结构调整选择器

---

## 📊 效果统计

运行后会生成报告：`data/douyin/reply_report.json`

```json
{
  "时间": "2025-01-16 15:30:00",
  "总评论数": 500,
  "筛选后评论数": 50,
  "回复成功": 48,
  "回复失败": 2,
  "成功率": "96.0%",
  "详细结果": [...]
}
```

---

## 🎓 学习资源

### 核心文件说明

| 文件 | 功能 |
|-----|------|
| `tools/comment_filter.py` | 评论筛选器 |
| `tools/comment_replier.py` | 评论回复器（核心） |
| `快速回复评论.py` | 快速使用脚本 |
| `comment_reply_workflow.py` | 完整工作流 |

### 技术原理

1. **定位评论**：通过评论内容或comment_id查找DOM元素
2. **点击回复**：模拟点击回复按钮
3. **输入内容**：使用Playwright的type方法模拟打字
4. **发送回复**：点击发送按钮

---

## 💼 商业应用

### 适用行业

- 🛍️ 电商带货
- 📱 品牌营销
- 🎓 知识付费
- 🏠 本地生活
- 💄 美妆博主

### ROI提升

```
人工回复: 1条/分钟 × 60分钟 = 60条
自动回复: 1条/6秒 × 60分钟 = 600条

效率提升: 10倍
时间节省: 90%
```

---

## 🆘 获取帮助

如有问题，请查看：
1. 本文档的故障排查部分
2. 项目主README.md
3. 代码中的注释

---

## 📜 免责声明

本功能仅供学习和研究使用，请遵守：
1. 目标平台的使用条款
2. 相关法律法规
3. 不得用于恶意用途

使用本功能即表示您同意上述条款。

---

**祝使用愉快！🎉**
