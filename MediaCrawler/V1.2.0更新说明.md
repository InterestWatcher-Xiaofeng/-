# 🍁 红枫工具箱 V1.2.0 更新说明

## 📅 版本信息
- **版本号：** V1.2.0
- **发布日期：** 2025-10-30
- **更新类型：** 功能增强 + Bug修复

---

## 🎉 重大更新

### 1. 批量关键词采集功能 ⭐ 核心功能

**功能描述：**
支持在一次采集任务中，自动采集多组关键词的数据，每组关键词独立保存。

**使用方法：**
```
在关键词输入框中，每行输入一组关键词：

美食 探店
旅游 攻略
科技 数码
健身 教程
美妆 护肤
```

**功能特性：**
- ✅ 多行关键词输入（每行一组）
- ✅ 自动按顺序依次采集
- ✅ 实时显示进度（如：[2/5] 正在采集...）
- ✅ 每组关键词独立保存文件
- ✅ 文件名包含关键词和时间戳
- ✅ 支持任意数量的关键词组

**应用场景：**
- 多主题内容采集
- 竞品分析
- 热点追踪
- 批量数据收集

---

## 🐛 Bug修复

### 1. 浏览器启动失败问题

**问题描述：**
```
❌ 浏览器启动失败: cannot access local variable 'os' where it is not associated with a value
```

**根本原因：**
- `import os` 在条件块内（第1644行）
- 但在条件块外使用 `os` 变量（第1658行）
- 导致变量作用域错误

**修复方案：**
- 将 `import os` 移到函数顶部
- 确保所有代码都能访问 `os` 模块

**修复代码：**
```python
async def init_shared_browser(self, platform: str):
    try:
        from playwright.async_api import async_playwright
        import sys
        import os  # 🔥 修复：移到函数顶部
        
        # ... 后续代码
```

**修复效果：**
- ✅ 浏览器正常启动
- ✅ 登录功能恢复正常
- ✅ 采集功能可用

---

## 🔧 技术改进

### 1. UI组件升级

**改进前：**
```python
# 单行Entry输入框
self.keywords_entry = ctk.CTkEntry(
    keywords_frame,
    placeholder_text="请输入关键词，多个关键词用逗号分隔",
    width=400
)
```

**改进后：**
```python
# 多行TextBox输入框
self.keywords_textbox = ctk.CTkTextbox(
    keywords_frame,
    height=80,
    width=400,
    font=ctk.CTkFont(size=12)
)
```

**优势：**
- 支持多行输入
- 更直观的批量输入体验
- 占位符提示批量功能

### 2. 采集逻辑优化

**核心逻辑：**
```python
# 解析批量关键词
keywords_text = self.keywords_textbox.get("1.0", "end-1c").strip()
keywords_list = [line.strip() for line in keywords_text.split('\n') if line.strip()]

# 批量执行
total_groups = len(keywords_list)
for index, keywords in enumerate(keywords_list, 1):
    print(f"[{index}/{total_groups}] 正在采集: {keywords}")
    
    # 执行采集
    await self.async_douyin_crawler(
        keywords, 
        max_count, 
        content_type, 
        index,        # 当前索引
        total_groups  # 总数
    )
```

**优势：**
- 自动循环执行
- 进度实时显示
- 独立文件保存

### 3. 文件命名优化

**命名规则：**
```
search_comments_{关键词}_{时间戳}.{格式}
```

**示例：**
```
search_comments_美食探店_20251030_143052.csv
search_comments_旅游攻略_20251030_143500.csv
search_comments_科技数码_20251030_144000.csv
```

**优势：**
- 文件名包含关键词，易于识别
- 时间戳避免覆盖
- 每组独立保存，便于管理

---

## 📊 代码变更统计

### 修改文件
- `gui_app.py` - 主要修改
- `version.py` - 版本更新

### 变更行数
- 新增：约 100 行
- 修改：约 30 行
- 删除：约 10 行

### 关键函数变更

1. **UI初始化**
   - `setup_ui()` - 关键词输入框改为TextBox
   - `clear_keywords_placeholder()` - 新增占位符清除

2. **配置管理**
   - `load_config()` - 适配TextBox
   - `validate_config()` - 适配TextBox
   - `update_config()` - 适配TextBox
   - `on_mode_change()` - 适配TextBox

3. **采集逻辑**
   - `run_douyin_unified_crawler()` - 支持批量关键词
   - `async_douyin_crawler()` - 新增进度参数

4. **Bug修复**
   - `init_shared_browser()` - 修复os变量作用域

---

## 🎯 使用示例

### 示例1：批量采集不同主题

**输入：**
```
美食 探店
旅游 攻略
科技 数码
```

**配置：**
- 视频数量：10个
- 评论数量：50条
- 保存格式：CSV

**结果：**
```
✅ [1/3] 美食 探店 采集完成
   📄 search_comments_美食探店_20251030_140000.csv

✅ [2/3] 旅游 攻略 采集完成
   📄 search_comments_旅游攻略_20251030_140500.csv

✅ [3/3] 科技 数码 采集完成
   📄 search_comments_科技数码_20251030_141000.csv

🎉 批量采集全部完成！共完成 3 组关键词
```

### 示例2：竞品分析

**输入：**
```
品牌A 产品评测
品牌B 产品评测
品牌C 产品评测
```

**结果：**
- 每个品牌的评论数据独立保存
- 便于后续对比分析
- 数据不会混淆

---

## ⚠️ 注意事项

### 1. 兼容性
- ✅ 完全兼容旧版本
- ✅ 单行关键词仍然可用
- ✅ 多行关键词为新增功能

### 2. 性能影响
- 批量采集需要更长时间
- 建议关键词组数控制在 5-10 组
- 可随时停止采集

### 3. 数据管理
- 每组关键词生成独立文件
- 注意磁盘空间
- 定期清理旧数据

---

## 🔄 升级指南

### 从 V1.1.0 升级到 V1.2.0

**步骤1：备份数据**
```bash
# 备份现有数据（可选）
cp -r data data_backup
```

**步骤2：更新代码**
```bash
# 拉取最新代码
git pull origin main
```

**步骤3：重启应用**
```bash
# 重新启动GUI
python gui_app.py
```

**步骤4：验证功能**
- 检查浏览器是否正常启动
- 测试批量关键词输入
- 验证采集功能

---

## 📝 已知问题

### 1. 批量采集中途停止
- **现象：** 点击停止后，当前关键词仍会完成
- **原因：** 为保证数据完整性
- **解决：** 等待当前关键词完成后停止

### 2. 文件命名特殊字符
- **现象：** 关键词包含特殊字符时，文件名可能异常
- **建议：** 避免使用特殊字符（如：/ \ : * ? " < > |）

---

## 🚀 未来计划

### V1.3.0 规划
- [ ] 支持关键词导入（从文件读取）
- [ ] 支持关键词导出（保存为模板）
- [ ] 支持采集任务暂停和恢复
- [ ] 支持采集结果统计和分析

### V2.0.0 规划
- [ ] 支持更多平台（微信、知乎等）
- [ ] 支持数据可视化
- [ ] 支持定时采集任务
- [ ] 支持云端数据同步

---

## 📞 反馈与支持

### 问题反馈
- GitHub Issues: https://github.com/InterestWatcher-Xiaofeng/-/issues
- Email: 158789466+InterestWatcher-Xiaofeng@users.noreply.github.com

### 使用帮助
- 查看 `批量关键词功能说明.md`
- 查看 `GUI使用说明.md`
- 查看项目 README.md

---

## 🙏 致谢

感谢所有用户的反馈和建议！

特别感谢：
- 提出批量采集需求的用户
- 报告浏览器启动Bug的用户
- 持续支持本项目的所有用户

---

**祝您使用愉快！** 🎉

---

## 📜 更新日志

```
V1.2.0 (2025-10-30) - 批量关键词采集版
--------------------
🎉 重大更新：批量关键词自动采集
✅ 新增：批量关键词采集功能（每行一组关键词）
✅ 新增：多行关键词输入框（支持批量输入）
✅ 新增：采集进度实时显示（如：[2/5] 正在采集...）
✅ 新增：每组关键词独立保存数据文件
✅ 修复：浏览器启动失败问题（os变量作用域错误）
✅ 优化：批量采集完成后统一提示
✅ 优化：文件命名包含关键词和时间戳
✅ 改进：支持任意数量的关键词组批量采集
```

